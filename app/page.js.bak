'use client';

import { useState, useEffect, useRef } from 'react';
import Link from 'next/link';
import './landing.css';

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   FAQ DATA
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const FAQ_DATA = [
    {
        q: '¬øNecesito saber de marketing para usar WRITI.AI?',
        a: 'No. Solo escribe tu tema, elige el tono y listo. La IA hace el resto.',
    },
    {
        q: '¬øLos guiones suenan naturales o como ChatGPT gen√©rico?',
        a: 'WRITI.AI aprende tu voz de marca. Cuanto m√°s la usas, m√°s se adapta a tu estilo.',
    },
    {
        q: '¬øFunciona para cualquier nicho?',
        a: 'S√≠. Moda, fitness, negocios, gastronom√≠a, educaci√≥n, tecnolog√≠a ‚Äî cualquier nicho.',
    },
    {
        q: '¬øPuedo cancelar cuando quiera?',
        a: 'S√≠, sin permanencias ni penalizaciones. Cancelas en un clic desde tu configuraci√≥n.',
    },
    {
        q: '¬øHay l√≠mite de guiones en el plan Pro?',
        a: 'No. Guiones ilimitados en Pro y Agency.',
    },
];

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   LANDING PAGE COMPONENT
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
export default function LandingPage() {
    const [scrolled, setScrolled] = useState(false);
    const [openFaq, setOpenFaq] = useState(null);
    const [billing, setBilling] = useState('monthly');
    const [email, setEmail] = useState('');
    const [submitted, setSubmitted] = useState(false);
    const [submitting, setSubmitting] = useState(false);
    const [countdown, setCountdown] = useState({ h: 71, m: 59, s: 59 });
    const ctaRef = useRef(null);

    // Navbar scroll effect
    useEffect(() => {
        const onScroll = () => setScrolled(window.scrollY > 10);
        window.addEventListener('scroll', onScroll);
        return () => window.removeEventListener('scroll', onScroll);
    }, []);

    // Countdown timer (72h from first visit, stored in localStorage)
    useEffect(() => {
        let endTime;
        const stored = typeof window !== 'undefined' && localStorage.getItem('writi_offer_end');
        if (stored) {
            endTime = parseInt(stored, 10);
        } else {
            endTime = Date.now() + 72 * 60 * 60 * 1000;
            if (typeof window !== 'undefined') localStorage.setItem('writi_offer_end', endTime.toString());
        }

        const tick = () => {
            const diff = Math.max(0, endTime - Date.now());
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            setCountdown({ h, m, s });
        };
        tick();
        const id = setInterval(tick, 1000);
        return () => clearInterval(id);
    }, []);

    function scrollToCta() {
        ctaRef.current?.scrollIntoView({ behavior: 'smooth' });
    }

    async function handleEmailSubmit(e) {
        e.preventDefault();
        if (!email.trim() || submitting) return;
        setSubmitting(true);
        try {
            await fetch('/api/waitlist', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email.trim() }),
            });
            setSubmitted(true);
        } catch {
            setSubmitted(true); // Show success anyway for UX
        } finally {
            setSubmitting(false);
        }
    }

    const pad = (n) => String(n).padStart(2, '0');

    const prices = {
        monthly: { free: '‚Ç¨0', pro: '‚Ç¨29', agency: '‚Ç¨59', period: '/mes' },
        yearly: { free: '‚Ç¨0', pro: '‚Ç¨24', agency: '‚Ç¨49', period: '/mes' },
    };

    return (
        <div className="landing">
            {/* ‚ïê‚ïê‚ïê NAVBAR ‚ïê‚ïê‚ïê */}
            <nav className={`nav ${scrolled ? 'scrolled' : ''}`}>
                <span className="logo">WRITI.AI</span>
                <div className="nav-links">
                    <Link href="/login" className="btn-ghost">Iniciar sesi√≥n</Link>
                    <button className="btn-teal" onClick={scrollToCta}>Empezar gratis</button>
                </div>
            </nav>

            {/* ‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê */}
            <section className="hero">
                <h1 className="hero-headline">
                    Deja de perder 8 horas semanales<br />pensando qu√© publicar.
                </h1>
                <p className="hero-sub">
                    WRITI.AI genera 5 guiones virales para Reels, TikTok y LinkedIn en 30 segundos. Con tu voz. Con tu estilo. Listos para grabar.
                </p>
                <p className="hero-proof">
                    <span>‚ú¶</span> M√°s de 1.200 creadores ya generan contenido con WRITI.AI
                </p>

                <div className="hero-ctas">
                    <button className="btn-teal btn-teal-lg" onClick={scrollToCta}>
                        Generar mis primeros guiones gratis ‚Üí
                    </button>
                    <button className="btn-ghost-teal" onClick={() => document.getElementById('demo')?.scrollIntoView({ behavior: 'smooth' })}>
                        Ver c√≥mo funciona
                    </button>
                </div>

                <div className="hero-trust">
                    <span>‚úì Sin tarjeta de cr√©dito</span>
                    <span>‚úì Acceso instant√°neo</span>
                    <span>‚úì Cancela cuando quieras</span>
                </div>

                {/* Mockup */}
                <div className="hero-mockup">
                    <div className="mockup-left">
                        <div className="mockup-input">C√≥mo ganar 1.000 seguidores en 30 d√≠as</div>
                        <div className="mockup-chips">
                            <span className="mockup-chip active">Reels</span>
                            <span className="mockup-chip">TikTok</span>
                            <span className="mockup-chip">LinkedIn</span>
                            <span className="mockup-chip">X</span>
                        </div>
                        <div className="mockup-input" style={{ color: '#888' }}>Tono: Cercano</div>
                        <div className="mockup-btn">‚ú® Generar guiones</div>
                    </div>
                    <div className="mockup-right">
                        <div className="mockup-label">GANCHO</div>
                        <p>¬øPor qu√© llevas meses sin crecer y otros lo consiguen en semanas?</p>
                        <div className="mockup-label">DESARROLLO</div>
                        <ul>
                            <li>El algoritmo no es tu enemigo, tu contenido s√≠ lo es.</li>
                            <li>Los creadores que crecen publican con estructura, no con suerte.</li>
                            <li>Este m√©todo me hizo ganar 1.200 seguidores en 3 semanas.</li>
                        </ul>
                        <div className="mockup-label">CTA</div>
                        <p>Guarda este video y apl√≠calo hoy.</p>
                    </div>
                </div>
            </section>

            {/* ‚ïê‚ïê‚ïê PAIN POINTS ‚ïê‚ïê‚ïê */}
            <section>
                <h2 className="section-title">¬øTe suena familiar?</h2>
                <div className="pain-grid">
                    <div className="pain-card">
                        <span className="pain-icon">üò©</span>
                        <h3>El bloqueo creativo</h3>
                        <p>Te sientas a crear contenido y la mente en blanco. Pasan 2 horas y no has publicado nada.</p>
                    </div>
                    <div className="pain-card">
                        <span className="pain-icon">üîÅ</span>
                        <h3>Siempre el mismo formato</h3>
                        <p>Tus posts se parecen demasiado. Pierdes engagement porque tu audiencia ya sabe lo que vas a decir.</p>
                    </div>
                    <div className="pain-card">
                        <span className="pain-icon">‚è∞</span>
                        <h3>El tiempo que no tienes</h3>
                        <p>Gestionas 5 clientes o cuentas. Crear contenido desde cero para todos es imposible. Algo siempre sale mal.</p>
                    </div>
                </div>
            </section>

            {/* ‚ïê‚ïê‚ïê HOW IT WORKS ‚ïê‚ïê‚ïê */}
            <section id="demo">
                <h2 className="section-title">As√≠ de simple.</h2>
                <p className="section-subtitle">De idea a gui√≥n viral en 3 pasos.</p>
                <div className="steps-grid">
                    <div className="step-item">
                        <div className="step-num">01</div>
                        <h3>Escribe tu tema</h3>
                        <p>Un t√≠tulo, una URL, una frase. WRITI.AI lo convierte en contenido.</p>
                    </div>
                    <div className="step-item">
                        <div className="step-num">02</div>
                        <h3>Elige plataforma y tono</h3>
                        <p>Reels, TikTok, LinkedIn o X. Profesional, cercano, inspiracional ‚Äî t√∫ decides c√≥mo sonar.</p>
                    </div>
                    <div className="step-item">
                        <div className="step-num">03</div>
                        <h3>Obt√©n 5 guiones listos</h3>
                        <p>Con Gancho, Desarrollo y CTA. C√≥pialos, gu√°rdalos y graba. Sin editar, sin pensar.</p>
                    </div>
                </div>
            </section>

            {/* ‚ïê‚ïê‚ïê PRODUCT PREVIEW ‚ïê‚ïê‚ïê */}
            <section>
                <h2 className="section-title">M√≠ralo en acci√≥n.</h2>
                <div className="hero-mockup" style={{ marginTop: '48px' }}>
                    <div className="mockup-left">
                        <div className="mockup-input">C√≥mo ganar 1.000 seguidores en 30 d√≠as</div>
                        <div className="mockup-chips">
                            <span className="mockup-chip active">Reels</span>
                            <span className="mockup-chip">TikTok</span>
                            <span className="mockup-chip">LinkedIn</span>
                            <span className="mockup-chip">X</span>
                        </div>
                        <div className="mockup-input" style={{ color: '#888' }}>Tono: Cercano</div>
                        <div className="mockup-btn">‚ú® Generar guiones</div>
                    </div>
                    <div className="mockup-right">
                        <div className="mockup-label">GANCHO</div>
                        <p>¬øPor qu√© llevas meses sin crecer y otros lo consiguen en semanas?</p>
                        <div className="mockup-label">DESARROLLO</div>
                        <ul>
                            <li>El algoritmo no es tu enemigo, tu contenido s√≠ lo es.</li>
                            <li>Los creadores que crecen publican con estructura, no con suerte.</li>
                            <li>Este m√©todo me hizo ganar 1.200 seguidores en 3 semanas.</li>
                        </ul>
                        <div className="mockup-label">CTA</div>
                        <p>Guarda este video y apl√≠calo hoy.</p>
                    </div>
                </div>
            </section>

            {/* ‚ïê‚ïê‚ïê SOCIAL PROOF ‚ïê‚ïê‚ïê */}
            <section>
                <h2 className="section-title">Lo que dicen los que ya lo usan.</h2>
                <div className="testimonial-grid">
                    <div className="testimonial-card">
                        <div className="testimonial-header">
                            <div className="testimonial-avatar">M</div>
                            <span className="testimonial-name">Mar√≠a G. ‚Äî Creadora de contenido</span>
                        </div>
                        <div className="testimonial-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <p>Antes tardaba 4 horas en planificar la semana. Ahora lo hago en 20 minutos. WRITI.AI cambi√≥ completamente mi flujo de trabajo.</p>
                    </div>
                    <div className="testimonial-card">
                        <div className="testimonial-header">
                            <div className="testimonial-avatar">C</div>
                            <span className="testimonial-name">Carlos R. ‚Äî Agencia de marketing</span>
                        </div>
                        <div className="testimonial-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <p>Gestiono 8 clientes y el tiempo que me ahorra es brutal. Los guiones suenan naturales, no a robot.</p>
                    </div>
                    <div className="testimonial-card">
                        <div className="testimonial-header">
                            <div className="testimonial-avatar">L</div>
                            <span className="testimonial-name">Laura M. ‚Äî Coach de negocios</span>
                        </div>
                        <div className="testimonial-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <p>Mis Reels pasaron de 200 a 4.000 visualizaciones. El gancho que genera la IA es lo que marca la diferencia.</p>
                    </div>
                </div>
            </section>

            {/* ‚ïê‚ïê‚ïê PRICING ‚ïê‚ïê‚ïê */}
            <section>
                <h2 className="section-title">Sin letra peque√±a. Sin sorpresas.</h2>
                <p className="section-subtitle">Empieza gratis. Escala cuando quieras.</p>

                <div className="pricing-toggle-wrapper">
                    <div className="pricing-toggle">
                        <button className={billing === 'monthly' ? 'active' : ''} onClick={() => setBilling('monthly')}>Mensual</button>
                        <button className={billing === 'yearly' ? 'active' : ''} onClick={() => setBilling('yearly')}>Anual (ahorra 17%)</button>
                    </div>
                </div>

                <div className="pricing-grid">
                    {/* Free */}
                    <div className="pricing-card">
                        <div className="pricing-label">Gratis</div>
                        <div className="pricing-price">{prices[billing].free}<span className="pricing-period">{prices[billing].period}</span></div>
                        <ul className="pricing-features">
                            <li>10 guiones al mes</li>
                            <li>Reels y TikTok</li>
                            <li>Acceso a biblioteca</li>
                            <li>Sin tarjeta de cr√©dito</li>
                        </ul>
                        <button className="btn-ghost-teal" style={{ width: '100%' }} onClick={scrollToCta}>Empezar gratis</button>
                    </div>

                    {/* Pro */}
                    <div className="pricing-card featured">
                        <div className="pricing-popular">M√ÅS POPULAR</div>
                        <div className="pricing-label">Pro</div>
                        <div className="pricing-price">{prices[billing].pro}<span className="pricing-period">{prices[billing].period}</span></div>
                        {billing === 'yearly' && <div className="pricing-period" style={{ marginTop: '-20px' }}>Facturado anualmente (‚Ç¨288/a√±o)</div>}
                        <ul className="pricing-features">
                            <li>Guiones ilimitados</li>
                            <li>Todas las plataformas</li>
                            <li>Memoria de voz de marca</li>
                            <li>Biblioteca ilimitada</li>
                            <li>Soporte prioritario</li>
                        </ul>
                        <button className="btn-teal" style={{ width: '100%' }} onClick={scrollToCta}>Empezar con Pro ‚Üí</button>
                    </div>

                    {/* Agency */}
                    <div className="pricing-card">
                        <div className="pricing-label">Agency</div>
                        <div className="pricing-price">{prices[billing].agency}<span className="pricing-period">{prices[billing].period}</span></div>
                        <ul className="pricing-features">
                            <li>Todo lo de Pro</li>
                            <li>Hasta 10 marcas / clientes</li>
                            <li>Reportes descargables</li>
                            <li>White label b√°sico</li>
                            <li>Acceso API</li>
                        </ul>
                        <button className="btn-ghost-teal" style={{ width: '100%' }} onClick={scrollToCta}>Hablar con ventas</button>
                    </div>
                </div>
            </section>

            {/* ‚ïê‚ïê‚ïê OFFER BANNER ‚ïê‚ïê‚ïê */}
            <section className="offer-banner">
                <div className="offer-wrapper">
                    <div className="offer-title">üéÅ OFERTA DE LANZAMIENTO ‚Äî Solo esta semana: 3 meses de Pro gratis si te registras hoy.</div>
                    <p className="offer-sub">M√°s de 340 personas ya aprovecharon esta oferta.</p>
                    {/* <div className="offer-timer">{pad(countdown.h)}:{pad(countdown.m)}:{pad(countdown.s)}</div> */}
                    <div className="offer-timer">--:--:--</div>
                    <button className="btn-dark" onClick={scrollToCta}>Quiero mis 3 meses gratis ‚Üí</button>
                </div>
            </section>

            {/* ‚ïê‚ïê‚ïê FAQ ‚ïê‚ïê‚ïê */}
            <section>
                <h2 className="section-title">Preguntas frecuentes.</h2>
                <div className="faq-list">
                    {FAQ_DATA.map((item, idx) => (
                        <div key={idx} className="faq-item">
                            <button className="faq-question" onClick={() => setOpenFaq(openFaq === idx ? null : idx)}>
                                {item.q}
                                <span className={`faq-arrow ${openFaq === idx ? 'open' : ''}`}>‚ñº</span>
                            </button>
                            <div className={`faq-answer ${openFaq === idx ? 'open' : ''}`}>
                                <p>{item.a}</p>
                            </div>
                        </div>
                    ))}
                </div>
            </section>

            {/* ‚ïê‚ïê‚ïê FINAL CTA ‚ïê‚ïê‚ïê */}
            <section className="final-cta" ref={ctaRef}>
                <h2 className="section-title">Tu competencia ya est√° publicando<br />m√°s r√°pido que t√∫.</h2>
                <p className="section-subtitle" style={{ marginBottom: '0' }}>Empieza hoy. Los primeros 10 guiones son completamente gratis.</p>

                {!submitted ? (
                    <>
                        <form className="email-form" onSubmit={handleEmailSubmit}>
                            <input
                                type="email"
                                placeholder="Tu email profesional"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                required
                            />
                            <button type="submit" className="btn-teal" disabled={submitting}>
                                {submitting ? 'Enviando...' : 'Empezar gratis ‚Üí'}
                            </button>
                        </form>
                        <p className="email-micro">
                            <span>‚úì</span> Sin tarjeta ¬∑ <span>‚úì</span> Acceso en 30 segundos ¬∑ <span>‚úì</span> Cancela cuando quieras
                        </p>
                    </>
                ) : (
                    <p className="success-msg">¬°Listo! Te avisamos cuando abra el acceso anticipado. üéâ</p>
                )}
            </section>

            {/* ‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê */}
            <footer className="lp-footer" style={{ maxWidth: '100%' }}>
                <div className="footer-left">
                    <span className="logo" style={{ fontSize: '0.9rem' }}>WRITI.AI</span>
                    <p>¬© 2026 WRITI.AI. Todos los derechos reservados.</p>
                </div>
                <div className="footer-links">
                    <a href="#">Privacidad</a>
                    <a href="#">T√©rminos</a>
                    <a href="#">Contacto</a>
                </div>
            </footer>
        </div>
    );
}
